# ðŸ”– Hypothesis Testing: z-test {#ztest}

<script src="files/js/dcl.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"> </script>

```{r ,include=FALSE}
tutorial::go_interactive(greedy = FALSE)

```

- **Lecture slides: **     <button class="btn btn-primary" data-toggle="collapse" data-target="#HPT12">Hypothesis Testing</button> <button class="btn btn-primary" data-toggle="collapse" data-target="#CLT12">Central Limit Theorem</button>
<div id="HPT12" class="collapse">
<embed src="https://docs.google.com/presentation/d/17zX82imn7S3_r9Uls3pqInIwdPx1NIQW-O22ynSa9Sg/edit?usp=sharing" width="100%" height="500px"></embed>
</div>
<div id="CLT12" class="collapse">
<embed src="https://docs.google.com/presentation/d/15VRfffVukRxQ8V9Oh_KRG8T7dIuPjlXaYySdcqvXryQ/edit?usp=sharing" width="100%" height="500px"></embed>
</div>

<br>

- **Great Resource: **     <a href = "https://www.khanacademy.org/math/statistics-probability/significance-tests-confidence-intervals-two-samples/comparing-two-means/v/hypothesis-test-for-difference-of-means" target="_blank"> <button class="btn btn-primary" data-toggle="collapse" data-target="#KH12">Khan Academy</button> </a>

## Introduction

The following synthetic data describes daily traffic on weekday and weekend days in Lincoln and Holland tunnels. The data frame has three attributes: TUNNEL, DAY and VOLUME_PER_MINUTE.  Below we show a small sample of the TRAFFIC data frame

```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
traffic<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Traffic2022.csv") #web load
# head(moody)
temp<-knitr::kable(
  traffic[sample(1:nrow(traffic),10), ], caption = 'Snippet of Traffic Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```
<br>

The following snippet **6.2** shows the code for hypothesis test of difference of means.

Is the mean traffic (VOLUME_PER_MINUTE)  in the Holland tunnel bigger than  mean  traffic (VOLUME_PER_MINUTE)  in the Lincoln? 

## Snippet 1: Shows the code for z-test to test the following hypotheses{#pnorm}

**Null Hypothesis** - Traffic in Holland tunnel is the same as traffic in Lincoln tunnel.

**Alternative Hypothesis** - Traffic in the Holland Tunnel is larger than traffic in the Lincoln  tunnel.

In the snippet **6.2**  we end up calculating the p-value which leads to rejection of Null hypothesis (good news for data scientist, bad for the sceptic).  Indeed, p-value is less than the significance level  of 5%.
This means, that under null hypothesis it is extremely unlikely (less than 5% chance) to see the result which is at least as big as the  observed difference of means.

```{r,tut=TRUE,height=850}

TRAFFIC<-read.csv('https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Traffic2022.csv')

#data clean and subset, either
lincoln.data <- subset(TRAFFIC, TRAFFIC$TUNNEL == "Lincoln")
holland.data <- subset(TRAFFIC, TRAFFIC$TUNNEL == "Holland")

#traffic at lincoln
lincoln.traffic <- lincoln.data$VOLUME_PER_MINUTE

#traffic at holland
holland.traffic <- holland.data$VOLUME_PER_MINUTE

# standard deviation of two samples.
sd.lincoln <- sd(lincoln.traffic)
sd.holland <- sd(holland.traffic)
sd.lincoln
sd.holland

#length of lincoln and holland
len_lincoln <- length(lincoln.traffic)
len_holland <- length(holland.traffic)
len_lincoln
len_holland

#standard deviation of difference traffic
sd.lin.hol <- sqrt(sd.lincoln^2/len_lincoln + sd.holland^2/len_holland)
sd.lin.hol

#means of two samples
mean.lincoln <- mean(lincoln.traffic)
mean.holland <- mean(holland.traffic)
mean.lincoln
mean.holland

#z score
zeta <- (mean.lincoln - mean.holland)/sd.lin.hol
zeta

#plot red line
plot(x=seq(from = -5, to= 5, by=0.1),y=dnorm(seq(from = -5, to= 5,  by=0.1),mean=0),type='l',xlab = 'mean difference',  ylab='possibility')
abline(v=zeta, col='red')

#get p
p = 1-pnorm(zeta)
p
```

## Snippet 2: Make your own data and see how p-value changes

How p-value is affected by difference of means and standard deviations.

We will build two distributions ourselves - varying the means and standard deviations. We will use **rnorm()** to generate normal distributions with given means and standard deviations. Then we will use a permutation test (can be a z-test as well) to test the difference of means for these two synthetic distributions. See for yourself the impact means and standard deviations have on p-values. You can do it by changing values of mean and standard deviation in the **rnorm()** function.

Clearly the further apart the mean values are - the lower the p-value. But how do standard deviations affect the p-value?  See for yourself.

Build the data frame with two attributes: Cat and Val, using **rnorm()** function

```{r,tut=TRUE,height=700}
Val1<-rnorm(10,mean=25, sd=10)
Val2<-rnorm(10,mean=35, sd=10)
Cat1<-rep("GroupA",10)  
Cat2<-rep("GroupB",10)  
Cat<-c(Cat1,Cat2) 
Val<-c(Val1,Val2)

d<-data.frame(Cat,Val)
Observed_Difference<-mean(d[d$Cat=='GroupB',2])-mean(d[d$Cat=='GroupA',2])
Observed_Difference

dA<-d[d$Cat=='GroupA',]
dA
dB<-d[d$Cat=='GroupB',]
dB

meanA<-mean(dA$Val)
meanB<-mean(dB$Val)

sdA<-sd(dA$Val)
sdB<-sd(dB$Val)

lenA<-nrow(dA)
lenA
lenB<-nrow(dB)
lenB

sd.A.B <- sqrt(sdA^2/lenA +sdB^2/lenB)
sd.A.B

zeta <- (meanB - meanA)/sd.A.B
zeta
p<-1-pnorm(zeta)
p
```

## Additional References

https://www.statisticshowto.com/probability-and-statistics/statistics-definitions/p-value/ <br>
http://www.z-table.com/ <br>
https://www.statisticshowto.com/probability-and-statistics/z-score/ <br>
https://sixsigmastudyguide.com/z-scores-z-table-z-transformations/