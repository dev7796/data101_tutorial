# üîñ Data puzzles

<script src="files/js/dcl.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

```{r ,include=FALSE}
tutorial::go_interactive()
```

```{r setup, include=FALSE}
library(shiny)
library(shinythemes)
library(shinyjs)
library(shinymanager)
library(googlesheets4)
gs4_deauth()
```

Data Puzzles are synthetically generated datasets with some embedded patterns.  Patterns have various forms from relationships between attributes to rules of the form ‚Äúif condition then value‚Äù between specific attribute-value pairs.  These patterns are stochastic and embedded in datasets using **DataMaker** -  our  Data Puzzle Generation Tool.

We use data puzzles extensively in the class assignments.  These range from data exploration and plotting through  hypothesis testing to prediction and machine learning.  After the assignment is completed we reveal the data secrets - the patterns which were embedded by DataMaker.  Students do not have to find exactly the embedded patterns, often they find related patterns which makes the ‚Äúgame‚Äù even more fun. 

 In the following  we provide the list of data puzzles along with the underlying data sets.  Using DataMaker we change the patterns and even data sets from academic year to academic year..  We can also provide data puzzles of different levels of difficulty from the  one star (easy) to five star (most difficult)  ones. 



## Strange grading methods of Professor Moody Data Puzzle

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv" download="moody2022_new.csv">moody2022_new.csv</a>

How to get a good grade in Professor Moody‚Äôs class?  

Professor Moody does not give final grades just on the basis of your total score alone. Our data shows that two students with the same total score may get widely varying final grades. Can you believe that you can even fail his class with a score as high as 82%? This is outrageous, isn‚Äôt it? 

DataMaker has generated  thousands of tuples  which in addition to the total score and final grade also store bizarre information about student behaviors in the class - do they often doze off? Does a student text a lot?  Does s/he ask a lot of questions?    Does it help if you ask a lot of questions? Does it hurt if you doze off a lot?

**Comment:** There is a series of Professor Moody‚Äôs puzzles which we have used over the years. We have used different attributes including student‚Äôs major, , seniority, class participation etc. 



```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv") #web load
# head(moody)
temp<-knitr::kable(
  head(moody, 5), caption = 'Snippet of Moody Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  head(moody, 5), caption = 'Snippet of Moody Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

### Practice Snippets 

#### Snippet 1: Get familiar with the data set

```{r,tut=TRUE,height=400}
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

colnames(moody)
summary(moody)
unique(moody$GRADE)
nrow(moody)
unique(moody$DOZES_OFF)
unique(moody$TEXTING_IN_CLASS)
table(moody$GRADE)
table(moody$DOZES_OFF)
table(moody$TEXTING_IN_CLASS)
tapply(moody$SCORE, moody$GRADE, mean)
tapply(moody$PARTICIPATION, moody$GRADE, mean)
tapply(moody$SCORE, moody$DOZES_OFF, mean)
tapply(moody$PARTICIPATION, moody$DOZES_OFF, mean)
tapply(moody$SCORE, moody$TEXTING_IN_CLASS, mean)
tapply(moody$PARTICIPATION, moody$TEXTING_IN_CLASS, mean)

```

#### Snippet 2

**Q:** Did you know that students who never doze off in class have more than twice as many A‚Äôs than students who sometimes doze off?

```{r,tut=TRUE,height=400}
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

table(moody$DOZES_OFF, moody$GRADE)
```

#### Snippet 3

**Q:** Did you know that the students who scored over 85 and still received a B almost always dozed off all the time during class?

```{r,tut=TRUE,height=400}
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

moody[(moody$SCORE>85) & (moody$GRADE=='B'), ]$DOZES_OFF
```

#### Snippet 4

**Q:** What gives a higher chance of failing, texting all the time or always dozing off during class? <br>
**A:** Always texting in class! Almost 40% chance of failing!

```{r,tut=TRUE,height=400}
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

#Probability of failing the class when dozing off all the time
nrow(moody[moody$DOZES_OFF=='always' & moody$GRADE=='F',])/nrow(moody[moody$DOZES_OFF=='always',])
#Probability of failing the class when  always texting in class 
nrow(moody[moody$TEXTING_IN_CLASS=='always' & moody$GRADE=='F',])/nrow(moody[moody$TEXTING_IN_CLASS=='always',])

```

#### Snippet 5

**Q:**  What grade did a student who scores 39.57 and always dozed off received? <br>
**A:**  D

```{r,tut=TRUE,height=400}
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

moody[moody$SCORE=='39.57'&moody$DOZES_OFF=='always',]$GRADE

```

#### Snippet 6

**Q:**  What are posterior odds that an A student never dozes off?  <br>
**A:** Posterior Odds = 2.66 <br>
Likelihood Ratio = 4 <br>
Prior Odds =0.56

```{r,tut=TRUE,height=400}
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

Prior<-nrow(moody[moody$DOZES_OFF =='never',])/nrow(moody)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
TruePositive<-round(nrow(moody[moody$GRADE=='A'& moody$DOZES_OFF=='never',])/nrow(moody[moody$DOZES_OFF=='always',]),2)
TruePositive
FalsePositive<-round(nrow(moody[moody$GRADE=='A'& moody$DOZES_OFF!='never',])/nrow(moody[moody$DOZES_OFF!='always',]),2)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,2)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
Posterior <-PosteriorOdds/(1+PosteriorOdds)
Posterior

```

#### Snippet 7

**Q:** Verify the hypothesis that C students have higher mean participation than F students? What is the p-value? <br>
**A:** Negative.  Fail to reject null hypothesis that mean participations of C and F students are the same with p=0.11

```{r,tut=TRUE,ex="permutationtestfunction3",type="pre-exercise-code"}
Permutation <- function(df1,c1,c2,n,w1,w2){
  df <- as.data.frame(df1)
  D_null<-c()
  V1<-df[,c1]
  V2<-df[,c2]
  sub.value1 <- df[df[, c1] == w1, c2]
  sub.value2 <- df[df[, c1] == w2, c2]
  D <-  abs(mean(sub.value2, na.rm=TRUE) - mean(sub.value1, na.rm=TRUE))
  m=length(V1)
  l=length(V1[V1==w2])
  for(jj in 1:n){
    null <- rep(w1,length(V1))
    null[sample(m,l)] <- w2
    nf <- data.frame(Key=null, Value=V2)
    names(nf) <- c("Key","Value")
    w1_null <- nf[nf$Key == w1,2]
    w2_null <- nf[nf$Key == w2,2]
    D_null <- c(D_null,mean(w2_null, na.rm=TRUE) - mean(w1_null, na.rm=TRUE))
  }
  myhist<-hist(D_null, prob=TRUE)
  multiplier <- myhist$counts / myhist$density
  mydensity <- density(D_null, adjust=2)
  mydensity$y <- mydensity$y * multiplier[1]
  plot(myhist)
  lines(mydensity, col='blue')
  abline(v=D, col='red')
  M<-mean(D_null>D)
  return(M)
}
```

```{r,tut=TRUE,ex="permutationtestfunction3",type="sample-code",height=400}
#install.packages("devtools")
#devtools::install_github("devanshagr/PermutationTestSecond")

#PermutationTestSecond::Permutation(d, "Cat", "Val",10000, "GroupA", "GroupB") 

moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

PermutationTestSecond::Permutation(moody, "GRADE", "PARTICIPATION",10000, "C", "F")

```

#### Snippet 8

**Q:** What is the mean score of students who  always doze off in class  and what is the most frequent grade that they received? <br>
**A:** The mean score is 50.26 and the most frequent grade is D.


```{r,tut=TRUE,height=400}
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

mean(moody[moody$DOZES_OFF=='always',]$SCORE)
table(moody[moody$DOZES_OFF=='always',]$GRADE)

```

<br>

Great job!! You have made it this far. You are now familiar with the moody dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check1). 

### Moody Data Quiz

<a href = "https://ds1778.shinyapps.io/data_roulette_1/" target = "blank"> Quiz Time </a>

### Check yourself {#check1}
```{r,tut=TRUE,height=600}
moody<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/moody2022_new.csv")

summary(moody)
```

<!--
### Secrets Revealed- Patterns in Professor Moody's data? 

<button class="btn btn-primary" data-toggle="collapse" data-target="#MDP12">My Patterns</button>
<div id="MDP12" class="collapse">    
<embed src="https://docs.google.com/viewer?url=https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/pred/HW3-Moody-My-patterns.pptx&embedded=true" width="100%" height="500px"></embed>
</div>
<br>
Many student solutions falsely attribute higher grades to higher values of participation attribute.. 

This is a classic example of a hidden variable described in the reference attached below. The truth is that participation attribute value impacts the score attribute value. Generally, the higher the participation in Moody‚Äôs class, the higher the score. But it is the score attribute which has a direct impact on the grade. Thus, it is the score which is the real ‚Äúhidden variable‚Äù impacting the final grade.

Thus, the score already reflects participation. Professor Moody seemed to look only at texting and dozing off attributes in grade determination (see the power points above with the explanation) 

Compare with examples of hidden variables in the following reference about correlation and causation. 

https://www.stewartmath.com/precalc_7e_dp/precalc_7e_dp6.html 

-->
<!--
### Best Student's Submissions 2022

<button class="btn btn-primary" data-toggle="collapse" data-target="#PPT2021">Lauretta Martin</button>
<button class="btn btn-primary" data-toggle="collapse" data-target="#PPT2020">Sanjaya Budhathoki</button>
<button class="btn btn-primary" data-toggle="collapse" data-target="#PPT2019">Sandhya Senthilkumar</button>

<div id="PPT2021" class="collapse">    
<embed src="https://docs.google.com/viewer?url=https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/pred/LM-HW3.pdf&embedded=true" width="100%" height="500px"></embed>
</div>

<div id="PPT2020" class="collapse">    
<embed src="https://docs.google.com/viewer?url=https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/pred/SB-HW3.pdf&embedded=true" width="100%" height="500px"></embed>
</div>

<div id="PPT2019" class="collapse">    
<embed src="https://docs.google.com/viewer?url=https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/pred/HW3-SS.pptx&embedded=true" width="100%" height="500px"></embed>
</div>


## Magic Coin: Heads or Tails? Data Puzzle

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Tosses2022.csv" download="Tosses2022.csv">Tosses2022.csv</a>

Your goal is to discover secrets of a magic coin. Ordinary coins when tossed a large number of times  result equally often in Heads and in Tails.  The magic coin  though is not an ordinary coin.  Your job is to discover when the magic coin is most biased one way or another.  The data consists of thousands of tosses of the magic coin including where the toss took place, who tossed it, who reported the result as well as the time of the day.

```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
toss<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Tosses2022.csv") #web load
# head(moody)
temp<-knitr::kable(
  toss[sample(1:nrow(toss),5), ], caption = 'Snippet of Magic Coin Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  toss[sample(1:nrow(toss),5), ], caption = 'Snippet of Magic Coin Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

<br>

You are now familiar with the Magic Coin dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check2). 

### Practice Snippets 

#### Snippet 1
#### Snippet 2
#### Snippet 3
#### Snippet 4
#### Snippet 5
#### Snippet 6
#### Snippet 7
#### Snippet 8
#### Snippet 9

### Magic Coin Data Quiz

<a href = "https://ds1778.shinyapps.io/data_roulette_2/" target = "blank"> Quiz Time  </a>

### Check yourself {#check2}
```{r,tut=TRUE,height=600}
toss<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Tosses2022.csv")

summary(toss)
```

-->


## How to predict a good party?  Data puzzle

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Partyb.csv" download="Partyb.csv">Partyb.csv</a>

DataMaker has generated data about thousands of parties, some fun parties, others which were OK or simply boring.  Your goal is to discover secrets of a fun party. Is it music? Dancing? Does the host matter? Or who was present at a party? Maybe who was NOT present at the party?  All this data is stored in this data puzzle.

```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
party<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Partyb.csv") #web load
# head(moody)
temp<-knitr::kable(
  party[sample(1:nrow(party),5), ], caption = 'Snippet of Party Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  party[sample(1:nrow(party),5), ], caption = 'Snippet of Party Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

### Practice Snippets 

#### Snippet 1: Get to know your data

```{r,tut=TRUE,height=400}
party<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Partyb.csv")

colnames(party)
nrow(party)
summary(party)
unique(party$Party)
unique(party$Music)
unique(party$Host)
unique(party$WasThere)
unique(party$WasNotThere)
table(party$Party)
table(party$Music)
table(party$Host)
table(party$WasThere)
table(party$WasNotThere)
colnames(party)
tapply(party$CaloriesDanc, party$Party, mean)
tapply(party$CaloriesDanc, party$Music, mean)
tapply(party$CaloriesDanc, party$Host, mean)
tapply(party$CaloriesDanc, party$WasThere, mean)
tapply(party$CaloriesDanc, party$WasNotThere, mean)

```

#### Snippet 2

**Q:** Did you know that a party is often boring when Angela is not there?

```{r,tut=TRUE,height=400}
party<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Partyb.csv")

table(party[party$WasNotThere=='Angela',]$Party)

```

#### Snippet 3

**Q:** What are the odds of the party being fun when Vladimir is not there? <br>
**A:** PosteriorOdds = 2.91 <br>
LikelihoodRatio = 3.83 <br>
Prior Odds = 0.76


```{r,tut=TRUE,height=400}
party<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Partyb.csv")

Prior<-nrow(party[party$Party =='Fun',])/nrow(party)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
TruePositive<-round(nrow(party[party$Party=='Fun'& party$WasNotThere=='Vladimir',])/nrow(party[party$Party=='Fun',]),2)
TruePositive
FalsePositive<-round(nrow(party[party$Party!='Fun'& party$WasNotThere=='Vladimir',])/nrow(party[party$Party!='Fun',]),2)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,2)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
Posterior <-PosteriorOdds/(1+PosteriorOdds)
Posterior
```

#### Snippet 4

**Q:** Verify the hypothesis that there is more dancing at Fun parties than at Boring parties? <br>
**A:** Positive. We reject null hypothesis that there is same amount of dancing at Fun and Boring parties with p < 0.00001

```{r,tut=TRUE,ex="permutationtestfunction4",type="pre-exercise-code"}
Permutation <- function(df1,c1,c2,n,w1,w2){
  df <- as.data.frame(df1)
  D_null<-c()
  V1<-df[,c1]
  V2<-df[,c2]
  sub.value1 <- df[df[, c1] == w1, c2]
  sub.value2 <- df[df[, c1] == w2, c2]
  D <-  abs(mean(sub.value2, na.rm=TRUE) - mean(sub.value1, na.rm=TRUE))
  m=length(V1)
  l=length(V1[V1==w2])
  for(jj in 1:n){
    null <- rep(w1,length(V1))
    null[sample(m,l)] <- w2
    nf <- data.frame(Key=null, Value=V2)
    names(nf) <- c("Key","Value")
    w1_null <- nf[nf$Key == w1,2]
    w2_null <- nf[nf$Key == w2,2]
    D_null <- c(D_null,mean(w2_null, na.rm=TRUE) - mean(w1_null, na.rm=TRUE))
  }
  myhist<-hist(D_null, prob=TRUE)
  multiplier <- myhist$counts / myhist$density
  mydensity <- density(D_null, adjust=2)
  mydensity$y <- mydensity$y * multiplier[1]
  plot(myhist)
  lines(mydensity, col='blue')
  abline(v=D, col='red')
  M<-mean(D_null>D)
  return(M)
}
```

```{r,tut=TRUE,ex="permutationtestfunction4",type="sample-code",height=400}
party<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Partyb.csv")

mean(party[party$Party=='Fun',]$CaloriesDanc)
mean(party[party$Party=='Boring',]$CaloriesDanc)

PermutationTestSecond::Permutation(party, "Party", "CaloriesDanc",10000, "Fun", "Boring")

```

#### Snippet 5

**Q:** What music is the most popular at Fun parties? <br>
**A:** HipHop

The following snippet allows us to find the most popular music, although the code just returns the frequency of music genres distribution. 

```{r,tut=TRUE,height=400}
party<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Partyb.csv")

table(party[party$Party=='Fun',]$Music)
```
<br>

You are now familiar with the Party dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check3). 


### Party Data Quiz

<a href = "https://ds1778.shinyapps.io/data_roulette_3/" target = "blank"> Quiz Time </a>

### Check yourself {#check3}
```{r,tut=TRUE,height=600}
party<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Partyb.csv")

summary(party)
```

## When election is truly local - data puzzle

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv" download="Voting1.csv">Voting1.csv</a>

In local elections in some small towns, candidates of three local parties: Royalists, KnowNothings and Anarchists are running for the office of the mayor. DataMaker has generated a survey of thousands of town residents and their political sympathies. Data of course can not be more local, leaving global concerns such as inflation or global warming to national or state office candidates.  

Here, the electorate cares  about  issues such as ‚Äúshould we allow leaflowers‚Äù (all, only electric, none?), what about CBD stores in town (none, just one, no restrictions), How about liquor (should the town be dry? Or hard liqueurs only). Speed limits? (none, 10mph etc) or even more extreme - the whole town being car-free, streets open only to bicycles and pedestrians?

Can we develop the profiles of voters for each of the parties? What does the  anarchist electorate  care about? Which party is leading among young people who do not want any speed limits in town?


```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
voting<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv") #web load
# head(moody)
temp<-knitr::kable(
  voting[sample(1:nrow(voting),5), ], caption = 'Snippet of Voting Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  voting[sample(1:nrow(voting),5), ], caption = 'Snippet of Voting Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

### Practice Snippets 

#### Snippet 1: Get to know your data

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

colnames(vote)
nrow(vote)
summary(vote)
unique(vote$LeafBlowers)
unique(vote$CBD)
unique(vote$GasMowers)
unique(vote$Party)
unique(vote$LiquerStores)
unique(vote$SpeedLimit)

table(vote$Party)
table(vote$SpeedLimit)
table(vote$LeafBlowers)
table(vote$GasMowers)

```

#### Snippet 2

**Q:**  Which party has the oldest constituents? <br>
**A:** Royalists


```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

tapply(vote$Age, vote$Party, mean)

```

#### Snippet 3

**Q:** How do voters who are against Gas Mowers vote? <br>
**A:** Royalists

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

table(vote[vote$LeafBlowers=='None',]$Party)
```

#### Snippet 4

**Q:** How do KnowNothings voters vote on speed limits?

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

table(vote[vote$Party=='KnowNothings',]$SpeedLimit)
```

#### Snippet 5

**Q:** What is the age of the oldest voter for KnowNothings? <br>
**A:** 100

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

max(vote[vote$Party=='KnowNothings',]$Age)
```

#### Snippet 6

**Q:** Which party wins the most votes from supporters of no speed limits, no restrictions on CBD stores and Ban of Leaf Blowers?  <br>
**A:** Anarchists

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

table(vote[vote$SpeedLimit =='NoLimits'&vote$CBD=='NoRestrictions'& vote$LeafBlowers=='None', ]$Party)

```

#### Snippet 7

**Q:**  Which party wins the most votes of supporters of HardLiquerOnly Liquor stores?

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

table(vote[vote$LiquerStores=='HardLiquerOnly', ]$Party)
```

#### Snippet 8

**Q:**  What are the odds that a voter older than 65 will vote  for Royalists? <br>
**A:** Posterior Odds= 6.44 <br>
Likelihood ratio = 6.08 <br>
Prior Odds= 1.06

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

Prior<-nrow(vote[vote$Party =='Royalists',])/nrow(vote)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
TruePositive<-round(nrow(vote[vote$Party=='Royalists'& vote$Age>65,])/nrow(vote[vote$Party=='Royalists',]),2)
TruePositive
FalsePositive<-round(nrow(vote[vote$Party!='Royalists'& vote$Age>65,])/nrow(vote[vote$Party!='Royalists',]),2)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,2)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
Posterior <-PosteriorOdds/(1+PosteriorOdds)
Posterior

```

#### Snippet 9

**Q:** Verify the hypothesis that the average age of Anarchists voters is higher than the average age of KnowNothings voters? <br>
**A:** Positive. Reject of null hypothesis that average ages of Anarchists and KnowNothings voters are the same

```{r,tut=TRUE,ex="permutationtestfunction5",type="pre-exercise-code"}
Permutation <- function(df1,c1,c2,n,w1,w2){
  df <- as.data.frame(df1)
  D_null<-c()
  V1<-df[,c1]
  V2<-df[,c2]
  sub.value1 <- df[df[, c1] == w1, c2]
  sub.value2 <- df[df[, c1] == w2, c2]
  D <-  abs(mean(sub.value2, na.rm=TRUE) - mean(sub.value1, na.rm=TRUE))
  m=length(V1)
  l=length(V1[V1==w2])
  for(jj in 1:n){
    null <- rep(w1,length(V1))
    null[sample(m,l)] <- w2
    nf <- data.frame(Key=null, Value=V2)
    names(nf) <- c("Key","Value")
    w1_null <- nf[nf$Key == w1,2]
    w2_null <- nf[nf$Key == w2,2]
    D_null <- c(D_null,mean(w2_null, na.rm=TRUE) - mean(w1_null, na.rm=TRUE))
  }
  myhist<-hist(D_null, prob=TRUE)
  multiplier <- myhist$counts / myhist$density
  mydensity <- density(D_null, adjust=2)
  mydensity$y <- mydensity$y * multiplier[1]
  plot(myhist)
  lines(mydensity, col='blue')
  abline(v=D, col='red')
  M<-mean(D_null>D)
  return(M)
}
```

```{r,tut=TRUE,ex="permutationtestfunction5",type="sample-code",height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

mean(vote[vote$Party=='Anarchists',]$Age) 
mean(vote[vote$Party=='KnowNothings',]$Age) 

PermutationTestSecond::Permutation(vote, "Party", "Age",10000, "Anarchists", "KnowNothings") 

```

#### Snippet 10

**Q:** What is the most frequent position of Anarchists on  the Speed Limit issue? <br>
**A:** ‚ÄúNo limits‚Äù is the most frequent position of Anarchists on Speed Limit issue

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

table(vote[vote$Party=='Anarchists',]$SpeedLimit)

```

#### Snippet 11

**Q:** Which party wins the  most votes  from  supporters of Electric Leaf Blowers? <br>
**A:** Royalists

```{r,tut=TRUE,height=400}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

table(vote[vote$LeafBlowers=='ElectricOnly',]$Party)

```
<br>

You are now familiar with the Election dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check4). 

### Election Data Quiz

<a href = "https://textbook.shinyapps.io/data_roulette_4/" target = "blank"> Quiz Time  </a>

### Check yourself {#check4}
```{r,tut=TRUE,height=600}
vote<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Voting1.csv")

summary(vote)
```







## Secrets of good sleep Data Puzzle 

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/SleepPrediction2.csv" download="SleepPrediction2.csv">SleepPrediction2.csv</a>

Who wouldn‚Äôt want to know the secrets of good sleep?  DataMaker has created a data set which may help to find these secrets. We store the number of exercise calories burnt during the day, the amount of wimpy tea a person has drunk (in ounces), hours spent on the computer and the quality of the preceding night‚Äôs sleep. 

```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/SleepPrediction2.csv") #web load
# head(moody)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Sleep Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Sleep Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```


### Practice Snippets 

#### Snippet 1: Get to know your data

```{r,tut=TRUE,height=400}
sleep<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/SleepPrediction2.csv")

colnames(sleep)
nrow(sleep)
summary(sleep)
unique(sleep$Sleep)
unique(sleep$WimpyTea)
unique(sleep$Moon)
unique(sleep$LastSleep)
table(sleep$Sleep)
table(sleep$WimpyTea)
table(sleep$Moon)
table(sleep$LastSleep)

```

#### Snippet 2

**Q:** Is exercising more good for your sleep? <br>
**A:** So and so. You either have Little sleep or deep sleep, much less likely to have shallow sleep

```{r,tut=TRUE,height=400}
sleep<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/SleepPrediction2.csv")

tapply(sleep$ExerciseCal, sleep$Sleep, mean)

```

#### Snippet 3

**Q:** What are the odds of Deep sleep when last day‚Äôs  sleep was Shallow? <br>
**A:** Posterior Odds= 15.27 (probability = 0.93!) <br>
Likelihood Ratio = 5.25 <br>
Prior Odds = 2.91


```{r,tut=TRUE,height=400}
sleep<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/SleepPrediction2.csv")

Prior<-nrow(sleep[sleep$Sleep =='Deep',])/nrow(sleep)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
TruePositive<-round(nrow(sleep[sleep$Sleep=='Deep'& sleep$LastSleep=='Shallow',])/nrow(sleep[sleep$Sleep=='Deep',]),2)
TruePositive
FalsePositive<-round(nrow(vote[sleep$Sleep!='Deep'& sleep$LastSleep=='Shallow',])/nrow(sleep[sleep$Sleep!='Deep',]),2)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,2)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
Posterior <-PosteriorOdds/(1+PosteriorOdds)
Posterior

```

#### Snippet 4

**Q:** Verify hypothesis that deep sleepers spend on average more time on the computer than Shallow sleepers? <br>
**A:** Negative. Fail to reject null hypotheses that means are the same.

```{r,tut=TRUE,ex="permutationtestfunction6",type="pre-exercise-code"}
Permutation <- function(df1,c1,c2,n,w1,w2){
  df <- as.data.frame(df1)
  D_null<-c()
  V1<-df[,c1]
  V2<-df[,c2]
  sub.value1 <- df[df[, c1] == w1, c2]
  sub.value2 <- df[df[, c1] == w2, c2]
  D <-  abs(mean(sub.value2, na.rm=TRUE) - mean(sub.value1, na.rm=TRUE))
  m=length(V1)
  l=length(V1[V1==w2])
  for(jj in 1:n){
    null <- rep(w1,length(V1))
    null[sample(m,l)] <- w2
    nf <- data.frame(Key=null, Value=V2)
    names(nf) <- c("Key","Value")
    w1_null <- nf[nf$Key == w1,2]
    w2_null <- nf[nf$Key == w2,2]
    D_null <- c(D_null,mean(w2_null, na.rm=TRUE) - mean(w1_null, na.rm=TRUE))
  }
  myhist<-hist(D_null, prob=TRUE)
  multiplier <- myhist$counts / myhist$density
  mydensity <- density(D_null, adjust=2)
  mydensity$y <- mydensity$y * multiplier[1]
  plot(myhist)
  lines(mydensity, col='blue')
  abline(v=D, col='red')
  M<-mean(D_null>D)
  return(M)
}
```

```{r,tut=TRUE,ex="permutationtestfunction6",type="sample-code",height=400}

sleep<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/SleepPrediction2.csv")

mean(sleep[sleep$Sleep=='Deep',]$OnComputer)
mean(sleep[sleep$Sleep=='Shallow',]$OnComputer)

PermutationTestSecond::Permutation(sleep, "Sleep", "OnComputer",10000, "Deep", "Shallow")

```

#### Snippet 5

**Q:** What is the highest Room temperature experienced by a  Deep sleeper? 

```{r,tut=TRUE,height=400}
sleep<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/SleepPrediction2.csv")

max(sleep[sleep$Sleep=='Deep',]$RoomTemp)
```
<br>

You are now familiar with the Sleep dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check5). 

### Sleep Data Quiz

<a href = "https://textbook.shinyapps.io/data_roulette_5/" target = "blank"> Quiz Time  </a>

### Check yourself {#check5}

```{r,tut=TRUE,height=600}
sleep<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/SleepPrediction2.csv")

summary(sleep)
```

## Let‚Äôs go to the movies:  Data Puzzle 

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv" download="Movies2022F-4.csv">Movies2022F-4.csv</a>

Using DataMaker  we have started with the imdb data set from Kaggle and embedded some patterns in it.  The original data set contains data about 12,800+ movies. We have expanded this data set by DataMaker‚Äôs opinions. Yes, only DataMaker can have an opinion on each of 12,800 movies! Can you predict which  movies does DataMaker love and which movies bore him so much that she quit?   What movies DataMaker passionately hates (hmm is DataMaker even passionate about anything at all?). 

When does DataMaker agree with the imdb score?

Can one predict an imdb score on the basis of a combination of DataMaker opinion (sort of super critic) and other attributes?


```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv") #web load
# head(moody)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Movies Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

### Practice Snippets 

#### Snippet 1: Get to know your data

```{r,tut=TRUE,height=500}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

colnames(movies)
nrow(movies)
summary(movies)
unique(movies$content)
unique(movies$genre)
unique(movies$Gross)
unique(movies$Budget)


table(movies$content)
table(movies$genre)
table(movies$Gross)
table(movies$Budget)

tapply(movies$imdb_score, movies$content, mean)
tapply(movies$imdb_score, movies$country, mean)
tapply(movies$imdb_score, movies$Gross, mean)
tapply(movies$imdb_score, movies$Budget, mean)
tapply(movies$imdb_score, movies$genre, mean)

```

#### Snippet 2

**Q:** What is the mean imdb of low budget comedies?

```{r,tut=TRUE,height=400}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

mean(movies[movies$Budget=='Low' & movies$genre=='Comedy', ]$imdb_score)
```

#### Snippet 3

**Q:** What is the lowest imdb score among high budget movies?

```{r,tut=TRUE,height=400}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

min(movies[movies$Budget=='High',]$imdb)
```

#### Snippet 4

**Q:**  How many low budget movies generated high gross income?

```{r,tut=TRUE,height=400}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

nrow(movies[movies$Budget=='Low' & movies$Gross =='High',])
```

#### Snippet 5

**Q:** What is the least frequent genre among UK movies?

```{r,tut=TRUE,height=400}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

table(movies[movies$country=='UK',]$genre, movies[movies$country=='UK',]$country)
```

#### Snippet 6

**Q:** Which content rating has the lowest average imdb score?

```{r,tut=TRUE,height=400}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

tapply(movies$imdb, movies$content, mean)
```

#### Snippet 7

**Q:** Movies from which country have the smallest average imdb score?

```{r,tut=TRUE,height=400}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

MA<-aggregate(movies$imdb_score, list(movies$country), mean)
colnames(MA)<-c("Country", "Mimdb")
MA<-MA[order(-MA$Mimdb), ]
MA[1,] 
```

#### Snippet 8

**Q:** What are the odds that a High Budget Movie will have High Gross Income? <br>
**A:** Prior Odds = 5.59 <br>
Likelihood  Ratio = 5.08 <br>
Prior Odds = 1.11


```{r,tut=TRUE,height=400}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

Prior<-nrow(market[movies$Gross =='High',])/nrow(movies)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
TruePositive<-round(nrow(movies[movies$Gross=='High'& movies$Budget=='High',])/nrow(movies[movies$Gross=='High',]),2)
TruePositive
FalsePositive<-round(nrow(movies[movies$Gross!='High'& movies$Budget=='High',])/nrow(movies[movies$Gross!='High',]),2)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,2)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
```
<br>

You are now familiar with the Movies dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check6). 

### Movies Data Quiz

<a href = "https://textbook.shinyapps.io/data_roulette_6/" target = "blank"> Quiz Time  </a>

### Check yourself {#check6}

```{r,tut=TRUE,height=600}
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Movies2022F-4.csv")

summary(movies)
```

<!--
### Secrets Revealed- Patterns in Movies data? 

<button class="btn btn-primary" data-toggle="collapse" data-target="#MV12">Secrets Revealed</button>
<div id="MV12" class="collapse">    
<embed src="https://docs.google.com/viewer?url=https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/pred/profhw4.pdf&embedded=true" width="100%" height="500px"></embed>
</div>



### Best Student's Submissions 2022

<button class="btn btn-primary" data-toggle="collapse" data-target="#hw41">Joshua Sze</button>
<button class="btn btn-primary" data-toggle="collapse" data-target="#hw42">Andrew Fasano</button>

<div id="hw41" class="collapse">    
<embed src="https://docs.google.com/viewer?url=https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/pred/student1hw4.pptx&embedded=true" width="100%" height="500px"></embed>
</div>

<div id="hw42" class="collapse">    
<embed src="https://docs.google.com/viewer?url=https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/pred/studen2hw4.pptx&embedded=true" width="100%" height="500px"></embed>
</div>
-->

## When canvas goes wild data puzzle 

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv" download="Canvas1.csv">Canvas1.csv</a>

You are all familiar with Canvas, right?  This is where you look to see your grades for each assignment and exam.  This is where you see the scores.  However it seems that Canvas went a bit wild and unfair in this data set.One can still fail the class with the score of 82 (sounds familiar, yes, Professor Moody would do it, but Canvas?

How can one get a lower grade  with a higher score?

Yes, Canvas was instructed by someone and your goal is to discover the grading method. How to get an A, how to pass?  We know who that someone is‚Ä¶ it is **DataMaker** of course. 

```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv") #web load
# head(moody)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Canvas Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Canvas Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

### Practice Snippets 

#### Snippet 1: Get to know your data

```{r,tut=TRUE,height=400}
grades<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv")

colnames(grades)
nrow(grades)
summary(grades)
unique(grades$Grade)
table(grades$Grade)
tapply(grades$Homeworks, grades$Grade, mean)
tapply(grades$Exams, grades$Grade, mean)
tapply(grades$Score, grades$Grade, mean)
```

#### Snippet 2

**Q:**  What  is the distribution of possible grades when a student‚Äôs total scores is over 80?

```{r,tut=TRUE,height=400}
grades<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv")

table(grades[grades$Score > 80,]$Grade)
```

#### Snippet 3

**Q:** Previous snippets showed that you can only get an A or an F with a score over 80. How can you get an F?  This snippet helps to answer this question.

```{r,tut=TRUE,height=400}
grades<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv")

table(grades[grades$Score > 80 & grades$Exams >40,]$Grade)
```

#### Snippet 4

**Q:** What is the worst exam score of a student with final grade A? <br>
**A:** 25

```{r,tut=TRUE,height=400}
grades<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv")

min(grades[grades$Grade =='A',]$Exams)
```

#### Snippet 5

**Q:** What are the odds of getting an A with an Exams score above 60? <br>
**A:** Posterior Odds = 0.45 <br>
Likelihood Ratio = 4.75 <br>
Prior Odds = 0.17


```{r,tut=TRUE,height=400}
grades<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv")

Prior<-nrow(grades[grades$Grade =='A',])/nrow(grades)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
TruePositive<-round(nrow(grades[grades$Grade=='A'& grades$Exams>60,])/nrow(grades[grades$Grade=='A',]),2)
TruePositive
FalsePostive<-round(nrow(grades[grades$Grade!='A'& grades$Exams<60,])/nrow(grades[grades$Grades!='A',]),2)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,2)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
Posterior <-PosteriorOdds/(1+PosteriorOdds)
Posterior

```

#### Snippet 6

**Q:** Verify Hypothesis that Mean exam score for B students is higher than mean exam score for C students.  What is the p-value? <br>
**A:** Negative. We fail to reject the null hypothesis with p=0.23

```{r,tut=TRUE,ex="permutationtestfunction7",type="pre-exercise-code"}
Permutation <- function(df1,c1,c2,n,w1,w2){
  df <- as.data.frame(df1)
  D_null<-c()
  V1<-df[,c1]
  V2<-df[,c2]
  sub.value1 <- df[df[, c1] == w1, c2]
  sub.value2 <- df[df[, c1] == w2, c2]
  D <-  abs(mean(sub.value2, na.rm=TRUE) - mean(sub.value1, na.rm=TRUE))
  m=length(V1)
  l=length(V1[V1==w2])
  for(jj in 1:n){
    null <- rep(w1,length(V1))
    null[sample(m,l)] <- w2
    nf <- data.frame(Key=null, Value=V2)
    names(nf) <- c("Key","Value")
    w1_null <- nf[nf$Key == w1,2]
    w2_null <- nf[nf$Key == w2,2]
    D_null <- c(D_null,mean(w2_null, na.rm=TRUE) - mean(w1_null, na.rm=TRUE))
  }
  myhist<-hist(D_null, prob=TRUE)
  multiplier <- myhist$counts / myhist$density
  mydensity <- density(D_null, adjust=2)
  mydensity$y <- mydensity$y * multiplier[1]
  plot(myhist)
  lines(mydensity, col='blue')
  abline(v=D, col='red')
  M<-mean(D_null>D)
  return(M)
}
```

```{r,tut=TRUE,ex="permutationtestfunction7",type="sample-code",height=400}
grades<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv")

mean(grades[grades$Grade=='B',]$Exams)
mean(grades[grades$Grade=='C',]$Exams)

PermutationTestSecond::Permutation(grades, "Grade", "Exams",10000, "C", "B") 

```

#### Snippet 7

**Q:** What is the chance of getting an A when you score less than 50 on exams? <br>
**A:** 0.093

```{r,tut=TRUE,height=400}
grades<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv")

nrow(grades[grades$Grade =='A' & grades$Exams < 50,])/nrow(grades[grades$Exams < 50,])

```
<br>

You are now familiar with the Canvas dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check7). 



### Canvas Data Quiz

<a href = "https://textbook.shinyapps.io/data_roulette_7/" target = "blank"> Quiz Time  </a>

### Check yourself {#check7}

```{r,tut=TRUE,height=600}
grades<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Canvas1.csv")

summary(grades)
```



## Very local minimarket data puzzle {#minimarket}

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/HomeworkMarket2022.csv" download="Minimarket.csv">HomeworkMarket2022.csv</a>

What items sell together? 

A small local minimarket chain (think Wawa at its early days) has a few locations in New Jersey and it sells beer, snacks, sweets. DataMaker provided the data set of several thousand of transactions in the minimarket storing what items were purchased, when they were purchased (weekday or weekend) at which location.  

```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
movies<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/HomeworkMarket2022.csv") #web load
# head(moody)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Minimarket Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  movies[sample(1:nrow(movies),5), ], caption = 'Snippet of Minimarket Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

### Practice Snippets 

#### Snippet 1: Get to know your data

```{r,tut=TRUE,height=400}
market<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/HomeworkMarket2022.csv")

colnames(market)
nrow(market)
summary(market)
unique(market$Day)
unique(market$Location)
unique(market$Beer)
unique(market$SoftDrinks)
unique(market$Sweets)
unique(market$Wine)
unique(market$Snacks)
table(market$Day)
table(market$Location)
table(market$Beer)
table(market$SoftDrinks)
table(market$Sweets)
table(market$Wine)
table(market$Snacks)

```

#### Snippet 2

**Q:**  What are  the odds that a customer in New Brunswick buys Lager on a weekend? <br>
**A:** Posterior Odds = 0.53 <br>
Likelihood Ratio = 1.08 <br>
Prior odds = 0.49


```{r,tut=TRUE,height=400}
market<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/HomeworkMarket2022.csv")

Prior<-nrow(market[market$Beer =='Lager',])/nrow(market)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
TruePositive<-round(nrow(market[market$Beer=='Lager'& market$Location=='New Brunswick' & market$Day =='Weekend',])/nrow(market[market$Beer=='Lager',]),2)
TruePositive
FalsePositive<-round(nrow(market[market$Beer!='Lager'& market$Location=='New Brunswick' & market$Day =='Weekend',])/nrow(market[market$Beer!='Lager',]),2)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,2)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
Posterior <-PosteriorOdds/(1+PosteriorOdds)
Posterior

```

#### Snippet 3

**Q:** What is the most frequent location of Lager purchases? <br>
**A:** Princeton is the most frequent location where Lager is sold

```{r,tut=TRUE,height=400}
market<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/HomeworkMarket2022.csv")

table(market[market$Beer =='Lager',]$Location)

```

#### Snippet 4

**Q:** Is distribution of purchases of snacks among Weekend buyers of Lager in New Brunswick  different from base  distribution of snacks? <br>
**A:** yes, very different

```{r,tut=TRUE,height=400}
market<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/HomeworkMarket2022.csv")

market$IN<-'Out_Slice'
market[market$Beer=='Lager' & market$Day=='Weekend' &  market$Location =='New Brunswick', ]$IN<-'In_Slice'
d<-table(market$Snacks,market$IN)
chisq.test(d)

```
<br>

You are now familiar with the MiniMarket dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check8). 

### MiniMarket Data Quiz

<a href = "https://ds1778.shinyapps.io/data_roulette_8/" target = "blank"> Quiz Time  </a>

### Check yourself {#check8}

```{r,tut=TRUE,height=600}
market<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/HomeworkMarket2022.csv")

summary(market)
```
<br>


Now it's time for two real data sets - the airbnb data set and titanic sinking data set, both from Kaggle. These data sets have been cleaned before, this is why we do not have to spend our time on data wrangling!  


## Airbnb data puzzle 

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv" download="airbnb.csv">airbnb.csv</a>

The airbnb data set (Kaggle) stores around 30,000 plus data points about airbnb prices in NYC. We have modified the original set a little bit (we can‚Äôt stop!) adding the floor where the department is located to the existing attributes such as Room type, neighbourhood_group (boroughs), specific neighborhood and price.

```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv") #web load
# head(moody)
temp<-knitr::kable(
  airbnb[sample(1:nrow(airbnb),5), ], caption = 'Snippet of Airbnb Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  airbnb[sample(1:nrow(airbnb),5), ], caption = 'Snippet of Airbnb Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

### Practice Snippets 

#### Snippet 1: Get to know your data

```{r,tut=TRUE,height=400}
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv")

nrow(airbnb)
summary(airbnb)
unique(airbnb$neighbourhood_group)
unique(airbnb$neighbourhood)
unique(airbnb$room_type)
unique(airbnb$floor)
table(airbnb$neighbourhood_group)
table(airbnb$neighbourhood)
table(airbnb$room_type)
table(airbnb$floor)
tapply(airbnb$price, airbnb$floor, mean)
tapply(airbnb$price, airbnb$neighbourhood, mean)
tapply(airbnb$price, airbnb$room_type, mean)

```

#### Snippet 2

**Q:** What is the price of the cheapest entire home/apt in Tribeca? <br>
**A:** $284


```{r,tut=TRUE,height=400}
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv")

min(airbnb[airbnb$room_type=='Entire home/apt' &airbnb$neighbourhood=='Tribeca',]$price)

```

#### Snippet 3

**Q:** What is the lowest price of accommodation above the 10th floor in Manhattan? <br>
**A:** $184

```{r,tut=TRUE,height=400}
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv")

min(airbnb[airbnb$floor >10 &airbnb$neighbourhood_group=='Manhattan',]$price)

```

#### Snippet 4

**Q:** What are the odds of finding a place for less than $200 in Tribeca? <br>
**A:** Posterior Odds = 0.09 <br>
Prior Odds = 0.86 <br>
Likelihood Ratio = 0.11


```{r,tut=TRUE,height=400}
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv")

Prior<-nrow(airbnb[airbnb$price<200,])/nrow(airbnb)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
nrow(airbnb[airbnb$price<200& airbnb$neighbourhood=='Tribeca',])
nrow(airbnb[airbnb$neighbourhood=='Tribeca',])
TruePositive<-round(nrow(airbnb[airbnb$price<200& airbnb$neighbourhood=='Tribeca',])/nrow(airbnb[airbnb$price<200,]),5)
TruePositive
FalsePositive<-round(nrow(airbnb[airbnb$price>200& airbnb$neighbourhood=='Tribeca',])/nrow(airbnb[airbnb$price>200,]),5)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,4)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
Posterior <-PosteriorOdds/(1+PosteriorOdds)
Posterior

```

#### Snippet 5

**Q:** Verify hypothesis that West Village is more expensive than Upper East Side? <br>
**A:** Positive. Null hypothesis is rejected with the p value p < 0.0001

```{r,tut=TRUE,ex="permutationtestfunction8",type="pre-exercise-code"}
Permutation <- function(df1,c1,c2,n,w1,w2){
  df <- as.data.frame(df1)
  D_null<-c()
  V1<-df[,c1]
  V2<-df[,c2]
  sub.value1 <- df[df[, c1] == w1, c2]
  sub.value2 <- df[df[, c1] == w2, c2]
  D <-  abs(mean(sub.value2, na.rm=TRUE) - mean(sub.value1, na.rm=TRUE))
  m=length(V1)
  l=length(V1[V1==w2])
  for(jj in 1:n){
    null <- rep(w1,length(V1))
    null[sample(m,l)] <- w2
    nf <- data.frame(Key=null, Value=V2)
    names(nf) <- c("Key","Value")
    w1_null <- nf[nf$Key == w1,2]
    w2_null <- nf[nf$Key == w2,2]
    D_null <- c(D_null,mean(w2_null, na.rm=TRUE) - mean(w1_null, na.rm=TRUE))
  }
  myhist<-hist(D_null, prob=TRUE)
  multiplier <- myhist$counts / myhist$density
  mydensity <- density(D_null, adjust=2)
  mydensity$y <- mydensity$y * multiplier[1]
  plot(myhist)
  lines(mydensity, col='blue')
  abline(v=D, col='red')
  M<-mean(D_null>D)
  return(M)
}
```

```{r,tut=TRUE,ex="permutationtestfunction8",type="sample-code",height=400}
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv")

PermutationTestSecond::Permutation(airbnb, "neighbourhood", "price",10000, "West Village", "Upper East Side")

```
<br>

You are now familiar with the Airbnb dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check9). 

### Airbnb Data Quiz

<a href = " https://textbook.shinyapps.io/data_roulette_9/?_ga=2.146438262.333337169.1654557226-2077060180.1654557226" target = "blank"> Quiz Time  </a>

### Check yourself {#check9}

```{r,tut=TRUE,height=600}
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv")

summary(airbnb)
```






## Titanic data puzzle 

Download: <a href="https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Titanic-train.csv" download="Titanic-train.csv">Titanic-train.csv</a>

The titanic data set (Kaggle) stores records of passengers of Titanic with attributes such as Survived, SibSp (family size), Fare, PClass (type of a cabin), Age etc.  Here is a sample of data

```{r,echo=FALSE}
# moody<-read.csv("../files/dataset/moody2020b.csv") #static Load
titanic<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Titanic-train.csv") #web load
# head(moody)
temp<-knitr::kable(
  titanic[sample(1:nrow(titanic),5), ], caption = 'Snippet of Titanic Dataset',
  booktabs = TRUE
)
temp<-knitr::kable(
  titanic[sample(1:nrow(titanic),5), ], caption = 'Snippet of Titanic Dataset',
  booktabs = TRUE
)
library(kableExtra)
kableExtra::scroll_box(temp,width = "100%")
```

### Practice Snippets 

#### Snippet 1: Get to know your data

```{r,tut=TRUE,height=400}
titanic<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Titanic-train.csv")

colnames(titanic)
nrow(titanic)
summary(titanic)
unique(titanic$Pclass)
unique(titanic$SibSp)
unique(titanic$Sex)
unique(titanic$Embarked)
unique(titanic$Survived)
table(titanic$Pclass)
table(titanic$SibSp)
table(titanic$Sex)
table(titanic$Embarked)
table(titanic$Survived)

```

#### Snippet 2

**Q:**  What are the odds of survival of single males on Titanic? <br>
**A:**  Posterior Odds = 0.196 <br>
Prior Odds = 0.62 <br>
Likelihood Ratio = 0.31



```{r,tut=TRUE,height=400}
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Titanic-train.csv")

Prior<-nrow(titanic[titanic$Survived==1,])/nrow(titanic)
Prior
PriorOdds<-round(Prior/(1-Prior),2)
PriorOdds
TruePositive<-round(nrow(titanic[titanic$Survived==1& titanic$Sex=='male' &titanic$SibSp==0,])/nrow(titanic[titanic$Survived==1,]),2)
TruePositive
FalsePositive<-round(nrow(titanic[titanic$Survived==0& titanic$Sex=='male'&titanic$SibSp==0,,])/nrow(titanic[titanic$Survived==0,]),2)
FalsePositive
LikelihoodRatio<-round(TruePositive/FalsePositive,4)
LikelihoodRatio
PosteriorOdds <-LikelihoodRatio * PriorOdds
PosteriorOdds
Posterior <-PosteriorOdds/(1+PosteriorOdds)
Posterior

```

#### Snippet 3

**Q:** Verify hypothesis that survivors paid on average more for the ticker than those who did not survive? <br>
**A:** Positive. Null hypothesis rejected with p < 0.0001

```{r,tut=TRUE,ex="permutationtestfunction9",type="pre-exercise-code"}
Permutation <- function(df1,c1,c2,n,w1,w2){
  df <- as.data.frame(df1)
  D_null<-c()
  V1<-df[,c1]
  V2<-df[,c2]
  sub.value1 <- df[df[, c1] == w1, c2]
  sub.value2 <- df[df[, c1] == w2, c2]
  D <-  abs(mean(sub.value2, na.rm=TRUE) - mean(sub.value1, na.rm=TRUE))
  m=length(V1)
  l=length(V1[V1==w2])
  for(jj in 1:n){
    null <- rep(w1,length(V1))
    null[sample(m,l)] <- w2
    nf <- data.frame(Key=null, Value=V2)
    names(nf) <- c("Key","Value")
    w1_null <- nf[nf$Key == w1,2]
    w2_null <- nf[nf$Key == w2,2]
    D_null <- c(D_null,mean(w2_null, na.rm=TRUE) - mean(w1_null, na.rm=TRUE))
  }
  myhist<-hist(D_null, prob=TRUE)
  multiplier <- myhist$counts / myhist$density
  mydensity <- density(D_null, adjust=2)
  mydensity$y <- mydensity$y * multiplier[1]
  plot(myhist)
  lines(mydensity, col='blue')
  abline(v=D, col='red')
  M<-mean(D_null>D)
  return(M)
}
```

```{r,tut=TRUE,ex="permutationtestfunction9",type="sample-code",height=400}
titanic<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Titanic-train.csv")

PermutationTestSecond::Permutation(titanic, "Survived", "Fare",10000, "1", "0")


```

#### Snippet 4

**Q:** What is the probability of survival for passengers who paid more than 100 pounds for a ticket?  How about those who paid less than 10 pounds? <br>
**A:**  0.73  for passengers who paid more than 100 pounds <br>
0.20 for passengers who paid less than 10 pounds <br>
0.38 for all passengers




```{r,tut=TRUE,height=400}
titanic<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Titanic-train.csv")

nrow(titanic[titanic$Fare >100 & titanic$Survived ==1,])/nrow(titanic[titanic$Fare >100,])
nrow(titanic[titanic$Fare <10 & titanic$Survived ==1,])/nrow(titanic[titanic$Fare <10,])
nrow(titanic[titanic$Survived ==1,])/nrow(titanic)

```

#### Snippet 5

**Q:** What was the chance of survival for passengers who traveled at least in a group of 3? <br>
**A:** Just 10%!

```{r,tut=TRUE,height=400}
titanic<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Titanic-train.csv")

table(titanic[titanic$SibSp>3,]$Survived)

```

#### Snippet 6

**Q:**  Did survival depend on the class of the cabin? <br>
**A:** Positive. Null hypothesis of independence rejected with p-value less than $e^{-16}$

```{r,tut=TRUE,height=400}
airbnb<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/Titanic-train.csv")

chisq.test(titanic$Survived, titanic$Pclass)

```
<br>

You are now familiar with the Titanic dataset and it's time to give your understanding a test. Please click the link below to get to the quiz and come back here to cross-check your answer in the snippet \@ref(check10). 

### Titanic Data Quiz

<a href = "https://dev7796.shinyapps.io/data_roulette_10/" target = "blank"> Quiz Time  </a>

### Check yourself {#check10}

```{r,tut=TRUE,height=600}
titanic<-read.csv("https://raw.githubusercontent.com/dev7796/data101_tutorial/main/files/dataset/airbnb.csv")

summary(titanic)
```






## Addiotional Reference 

<button class="btn btn-primary" data-toggle="collapse" data-target="#p12"> Prediction - Free Style </button> 
<div id="p12" class="collapse">
<embed src="https://docs.google.com/presentation/d/1pA0bzMGr_Tu2CXsgtT9Ks5apHqxWh8l1XXBVvwWr6zc/edit?usp=sharing" width="100%" height="500px"></embed>
</div>
